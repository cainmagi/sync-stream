---
id: redirect_stderr
title: redirect_stderr
sidebar_label: redirect_stderr
slug: /apis/base/redirect_stderr
description: contextlib.redirect_stderr经过特殊封装的版本。
---

import IconExternalLink from "@theme/Icon/ExternalLink";

import vsiCheckIcon from "@iconify-icons/codicon/check";

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

import APITopBar, {IconObjType} from "@site/src/components/APITopBar";
import InlineIcon from "@site/src/components/InlineIcon";

<APITopBar
  type="class"
  isPrivate={true}
  isContext={true}
  source="base.redirect_stderr"
/>

```python
with redirect_stderr(target: SupportsWrite):
    ...
```

[`contextlib.redirect_stderr`<IconExternalLink/>][link-restderr]经过特殊封装的版本。

该上下文允许`syncstream.LineBuffer`或其镜像用作重定向的目标，并不引起任何类型检查异常。

:::tip

该上下文可能是不需要使用的，因为形如`LineBuffer`的缓存、现在本身就已经是一个上下文了。

由于缓存上下文会同时令`stdout`和`stderr`重定向，若不想重定向`stdout`，有可能还是会需要用该上下文。

:::

## 别名 {#aliases}

该类可以按以下方式之一获取

```python
import syncstream


syncstream.redirect_stderr
syncstream.base.redirect_stderr
```

## 参数 {#arguments}

|   参数   |      类型       |               必选                | <center>说明</center>       |
| :------: | :-------------: | :-------------------------------: | :-------------------------- |
| `target` | `SupportsWrite` | <InlineIcon icon={vsiCheckIcon}/> | 支持`write`方法的可写缓存。 |

## 范例 {#example}

### <IconObjType type="term"/> 将stderr重定向到缓存 {#iconobjtype-typeterm-redirect-stderr-to-buffer}

<Tabs
  defaultValue="codes"
  values={[
    { label: 'Codes', value: 'codes', },
    { label: 'Better codes', value: 'better-codes', },
    { label: 'Results', value: 'results', },
  ]
}>

<TabItem value="codes">

```python showLineNumbers title="use_this_function.py"
import syncstream
from syncstream.base import redirect_stderr


buffer = syncstream.LineBuffer(10)
with redirect_stderr(buffer):
    try:
        raise TypeError("test-error!")
    except Exception as exc:
        print(exc, file=buffer)

messages = buffer.read()
for mitem in messages:
    print(mitem)
```

</TabItem>

<TabItem value="better-codes">

```python showLineNumbers title="use_buffer_context_directly.py"
import syncstream


buffer = syncstream.LineBuffer(10)
with buffer:  # stdout和stderr都捕获了。
    try:
        raise TypeError("test-error!")
    except Exception as exc:
        print(exc, file=buffer)

messages = buffer.read()
for mitem in messages:
    print(mitem)
```

</TabItem>

<TabItem value="results">

```shell
test-error!
```

</TabItem>
</Tabs>

[link-restderr]: https://docs.python.org/zh-cn/3/library/contextlib.html#contextlib.redirect_stderr
