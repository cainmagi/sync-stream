---
id: SafePoolManager
title: SafePoolManager
sidebar_label: SafePoolManager
slug: /apis/webtools/SafePoolManager
description: A wrapped urllib3.PoolManager with context supported.
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import IconExternalLink from "@theme/Icon/ExternalLink";

import vsiCheckIcon from "@iconify-icons/codicon/check";

import APITopBar, {IconObjType} from "@site/src/components/APITopBar";
import IconLink from "@site/src/components/IconLink";
import InlineIcon from "@site/src/components/InlineIcon";

<APITopBar
  type="class"
  isPrivate={true}
  isContext={true}
  source="webtools.SafePoolManager"
/>

```python
SafePoolManager(
    num_pools: int = 10,
    headers: dict[str, str] | None = None,
    **connection_pool_kw
) as pool:
    pool: SafePoolManager
```

A wrapped `urllib3.PoolManager` with context supported.

:::danger

This is a private class. Should not be used by users.

:::

## Arguments

See

<IconLink href="https://urllib3.readthedocs.io/en/stable/reference/urllib3.poolmanager.html" />

## Methods

### <IconObjType type="method"/> `request`

```python
req: SafeRequest[urllib3.BaseHTTPResponse] = pool.request(
    method: MethodApproved,
    url: str,
    fields: Mapping[str, str | bytes | ReqFile] | None = None,
    headers: Mapping[str, str] | None = None,
    **urlopen_kw,
)
```

Modified version of the `PoolManager.request(...)`

This method provide the typehints that are not available in the original
`urllib3` pacakge. The returned value is a wrapped [`SafeRequest`](./SafeRequest.mdx)
ready for used as a context, not simply an [`HTTPResponse`<IconExternalLink/>][link-httpresponse] object.

#### Requires

|    Argument    |                                        Type                                         |             Required              | <center>Description</center>                                                               |
| :------------: | :---------------------------------------------------------------------------------: | :-------------------------------: | :----------------------------------------------------------------------------------------- |
|    `method`    |                      [`MethodApproved`](./MethodApproved.mdx)                       | <InlineIcon icon={vsiCheckIcon}/> | The HTTP method of the request.                                                            |
|     `url`      |                                        `str`                                        | <InlineIcon icon={vsiCheckIcon}/> | The target URL of this request.                                                            |
|    `fields`    | <code>{`Mapping[str, str \| bytes \| `}[ReqFile](./ReqFile.mdx){`] \| None`}</code> |                                   | The multi-form fields to be sent, can be empty.                                            |
|   `headers`    |                             `Mapping[str, str] \| None`                             |                                   | The HTTP headers of this request.                                                          |
| `**urlopen_kw` |                                          -                                          |                                   | The other keywords will be forwarded to [`urlopen(...)`<IconExternalLink/>][link-urlopen]. |

#### Returns

| Argument |                             Type                             | <center>Description</center>                                                                                         |
| :------: | :----------------------------------------------------------: | :------------------------------------------------------------------------------------------------------------------- |
|  `req`   | [`SafeRequest[urllib3.BaseHTTPResponse]`](./SafeRequest.mdx) | A SafeRequest context object. Entering this context will provide the wrapped `HTTPResponse` returned by this method. |

---

### <IconObjType type="method"/> Other methods

Other methods can be referred here:

<IconLink href="https://urllib3.readthedocs.io/en/stable/reference/urllib3.poolmanager.html" />

## Example

### <IconObjType type="term"/> Use context to manage connections

<Tabs
  defaultValue="codes"
  values={[
    { label: 'Codes', value: 'codes', },
    { label: 'Results', value: 'results', },
  ]
}>

<TabItem value="codes">

```python showLineNumbers title="use_pool_context.py"
from syncstream.webtools import SafePoolManager


with SafePoolManager() as pool:
    with pool.request("get", "https://google.com") as req:
        # req is already managed by SafeRequest.
        print(req.status)
```

</TabItem>

<TabItem value="results">

```python
200
```

</TabItem>
</Tabs>

[link-httpresponse]: https://urllib3.readthedocs.io/en/stable/reference/urllib3.response.html#urllib3.response.HTTPResponse
[link-urlopen]: https://urllib3.readthedocs.io/en/stable/reference/urllib3.connectionpool.html#urllib3.HTTPConnectionPool.urlopen
